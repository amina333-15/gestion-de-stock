<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tableau de bord - AF.ELEC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- ICON LOGO ENTREPRISE -->
    <link rel="icon" href="logo.png">

    <style>

        /* ============================= */
    /* DASHBOARD ‚Äî CARTES STATISTIQUES */
    /* ============================= */

    .stats-grid {
        display: flex;
        gap: 2rem;
        flex-wrap: wrap;
        margin-top: 2rem;
    }

    .stat-box {
        flex: 1 1 calc(33% - 2rem);
        background-color: #ffffff; /* BLANC */
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        text-align: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .stat-box:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .stat-box h3 {
        color: var(--texte-titre);
        margin-bottom: 0.5rem;
    }

    .stat-box .nb {
        font-size: 2rem;
        font-weight: bold;
        color: var(--marron-fonce);
    }

    /* ============================= */
    /* √âTAT DU STOCK */
    /* ============================= */

    .stock-status {
        margin-top: 3rem;
    }

    .status-list {
        display: flex;
        gap: 2rem;
        flex-wrap: wrap;
    }

    .status-item {
        flex: 1 1 calc(33% - 2rem);
        background-color: #ffffff; /* BLANC */
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        text-align: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .status-item:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .status-item h4 {
        color: var(--texte-titre);
        margin-bottom: 0.5rem;
    }

    .status-item .nb {
        font-size: 1.6rem;
        font-weight: bold;
        color: var(--marron-fonce);
    }

    /* ============================= */
    /* PRODUITS CRITIQUES & TRANSACTIONS */
    /* ============================= */

    .product-list {
        max-height: 130px; /* ajuste selon la hauteur de ton bloc */
        overflow-y: auto;
        padding-right: 0.5rem; /* pour √©viter que le scroll cache le contenu */
    }

    .product-list::-webkit-scrollbar {
        width: 6px;
    }

    .product-list::-webkit-scrollbar-thumb {
        background-color: #c8b8a6;
        border-radius: 4px;
    }


    .product-list,
    .transaction-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 2rem;
    }

    .product-item,
    .transaction-item {
        background-color: #fcf8f2; /* BLANC */
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .product-item:hover,
    .transaction-item:hover {
        transform: translateX(4px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    /*.product-item img {*/
    /*    width: 50px;*/
    /*    height: 50px;*/
    /*    object-fit: cover;*/
    /*    border-radius: 6px;*/
    /*}*/

    .product-info h4,
    .transaction-info h4 {
        margin: 0;
        color: var(--texte-titre);
    }

    .product-info p,
    .transaction-info p {
        margin: 0.2rem 0;
        font-size: 0.9rem;
        color: #555;
    }
    .dashboard-layout {
        display: grid;
        grid-template-areas:
        "stock categories"
        "transactions transactions"
        "normal faible"
        "rupture rupture"
        "last critical";
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-top: 2rem;
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr; /* 3 colonnes √©gales */
        grid-template-rows: auto auto auto; /* 3 lignes */
        gap: 2rem;
        margin-top: 2rem;
    }

    /* Blocs normaux */
    .stat-box, .status-box, .half-box {
        background: #ffffff;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* Bloc √âtat du stock = double hauteur */
    .status-box {
        grid-row: span 2; /* occupe 2 lignes */
    }

    /* Derni√®re transaction + Produits critiques */
    .half-box {
        height: 200px; /* ou auto si tu veux */
    }






    .dashboard-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #ffffff;
        border: 1px solid #e0d6c8;
        border-radius: 10px;
        padding: 1rem 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .card-left {
        display: flex;
        flex-direction: column;
        text-align: left;
    }

    .card-label {
        font-size: 1rem;
        color: #6b4f2c;
        margin: 0;
    }

    .card-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: #3b2f2f;
        margin: 0.2rem 0 0;
    }

    .card-icon {
        background-color: #f5efe6;
        width: 40px;               /* largeur fixe */
        height: 40px;              /* hauteur identique ‚Üí rond parfait */
        border-radius: 50%;        /* cercle */
        color: #6b4f2c;
        font-size: 1.4rem;
        text-decoration: none;
        transition: background-color 0.3s ease;

        display: flex;
        align-items: center;
        justify-content: center;
    }

    .card-icon:hover {
        background-color: #e8dfd2;
    }

/*   stock-status-vertical   */

    .stock-status-vertical {
        display: flex;
        flex-direction: column;
        background-color: #ffffff;
        border: 1px solid #e0d6c8;
        border-radius: 10px;
        padding: 1rem;
        width: 400px;
        grid-row: span 2;
    }

    .stock-step {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .circle {
        width: 40px;
        height: 40px;
        background-color: #f5efe6;
        color: #6b4f2c;
        font-weight: bold;
        font-size: 1.2rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .label-block {
        display: flex;
        flex-direction: column;
    }

    .label-line {
        display: flex;
        justify-content: space-between;
        width: 320px; /* ajuste selon ton design */
    }

    .label {
        font-size: 0.95rem;
        color: #3b2f2f;
    }

    .value {
        font-size: 1.3rem;
        font-weight: bold;
        color: #6b4f2c;
    }

    .condition {
        font-size: 0.85rem;
        color: #6b4f2c;
    }

    .connector-vertical {
        width: 2px;
        height: 25px;
        background-color: #c8b8a6;
        margin: 0.5rem 0 0.5rem 19px; /* align√© au centre du cercle */
    }


    </style>

    <link rel="stylesheet" href="responsive.css">

</head>


<body>

<!-- HEADER / MENU -->
<header class="header">
    <div class="logo-container">
        <img src="logo.png" alt="Logo">
        <span>ELEC</span>
    </div>

    <nav>
        <a href="dashboard.html"><i class="bi bi-speedometer2"></i> Tableau de bord</a>
        <a href="stock.html"><i class="bi bi-box-seam"></i> Stock</a>
        <a href="categorie.html"><i class="bi bi-tags-fill"></i> Cat√©gories</a>
        <a href="restock.html"><i class="bi bi-arrow-repeat"></i> Restock</a>
        <a href="#" onclick="logout()"><i class="bi bi-power"></i></a>
    </nav>



    <!-- HEADER / MENU MOBILE -->
    <div class="header-mobile">

        <!-- Ic√¥ne menu -->
        <div class="icon-menu-custom" onclick="toggleMobileMenu()">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <!-- MENU D√âPLIANT MOBILE -->
        <div class="side-menu" id="mobileMenu">

            <div class="menu-header">
                <span>Menu</span>
                <i class="bi bi-x-lg" onclick="toggleMobileMenu()"></i>
            </div>

            <div class="menu-links">
                <a href="dashboard.html"><i class="bi bi-speedometer2"></i> Tableau de bord</a>
                <a href="stock.html"><i class="bi bi-box-seam"></i> Stock</a>
                <a href="categorie.html"><i class="bi bi-tags-fill"></i> Cat√©gories</a>
                <a href="restock.html"><i class="bi bi-arrow-repeat"></i> Restock</a>
                <a href="#" onclick="logout()"><i class="bi bi-power"></i> D√©connexion</a>
            </div>

        </div>

    </div>


<!--    <div class="icon-menu-custom">-->
<!--        <span></span>-->
<!--        <span></span>-->
<!--        <span></span>-->
<!--    </div>-->
</header>



<!-- CONTENU -->
<section class="container">
    <h1>Tableau de bord</h1>

    <div class="icon-custom-menu">
        <div></div>
    </div>


    <div class="dashboard-grid">

        <!-- Produits en stock -->
        <div class="dashboard-card">
            <div class="card-left">
                <p class="card-label">Produits en stock</p>
                <p class="card-value">7</p>
            </div>
            <a href="stock.html" class="card-icon">
                <i class="bi bi-box-seam"></i>
            </a>
        </div>

        <!-- Nombre de cat√©gories -->
        <div class="dashboard-card">
            <div class="card-left">
                <p class="card-label">Nombre de cat√©gories</p>
                <p class="card-value" id="nombre-categories">...</p>
            </div>
            <a href="categorie.html" class="card-icon">
                <i class="bi bi-tags"></i>
            </a>
        </div>

        <!-- √âtat du stock -->
        <div class="stock-status-vertical">

            <div class="stock-step">
                <div class="circle">1</div>
                <div class="label-block">
                    <div class="label-line">
                        <span class="label">Stock normal</span>
                        <span class="value" id="nb-stock-normal">0</span>
                    </div>
                    <span class="condition">‚â• 5</span>
                </div>
            </div>

            <div class="connector-vertical"></div>

            <div class="stock-step">
                <div class="circle">2</div>
                <div class="label-block">
                    <div class="label-line">
                        <span class="label">Stock faible</span>
                        <span class="value" id="nb-stock-faible">0</span>
                    </div>
                    <span class="condition">‚â§ 2</span>
                </div>
            </div>

            <div class="connector-vertical"></div>

            <div class="stock-step">
                <div class="circle">3</div>
                <div class="label-block">
                    <div class="label-line">
                        <span class="label">Rupture</span>
                        <span class="value" id="nb-stock-rupture">0</span>
                    </div>
                    <span class="condition">= 0</span>
                </div>
            </div>

        </div>

        <!-- Total transactions -->
        <div class="dashboard-card">
            <div class="card-left">
                <p class="card-label">Total des transactions</p>
                <p class="card-value" id="total-transactions">...</p>
            </div>
            <a href="restock.html" class="card-icon">
                <i class="bi bi-arrow-repeat"></i>
            </a>
        </div>

        <!-- Derni√®re ajout -->
        <div class="half-box" style="grid-column: 1 / span 2;">
            <h3>Derni√®re ajout au stock</h3>
            <p id="derniere-ajout" class="product-list">...</p>
        </div>

        <!-- Produits critiques -->
        <div class="half-box" style="grid-column: 3 / span 1;">
            <h3>Produits critiques</h3>
            <div id="produits-critiques" class="product-list"></div>
        </div>

    </div>
</section>

<!-- FOOTER -->
<footer>
    <div class="align-nav">
        <h1>Navigation</h1>
    </div>

    <div class="footer-container">
        <table class="footer-table">
            <tr>
                <td><a href="dashboard.html"><i class="bi bi-speedometer2"></i> Tableau de bord</a></td>
                <td><a href="restock.html"><i class="bi bi-arrow-repeat"></i> Restock</a></td>
            </tr>
            <tr>
                <td><a href="stock.html"><i class="bi bi-box-seam"></i> Stock</a></td>
                <td><a href="index.html"><i class="bi bi-power"></i> D√©connexion</a></td>
            </tr>
            <tr>
                <td><a href="categorie.html"><i class="bi bi-tags-fill"></i> Cat√©gories</a></td>
                <td><p>hkqsfbjqfb</p></td>
            </tr>
        </table>
    </div>
</footer>

<!-- FOOTER MOBILE -->
<div class="footer-app">
    <nav class="footer-nav">
    <a href="dashboard.html"><i class="bi bi-speedometer2"></i></a>
        <a href="stock.html"><i class="bi bi-box-seam"></i></a>
        <a href="categorie.html"><i class="bi bi-tags-fill"></i></a>
        <a href="restock.html"><i class="bi bi-arrow-repeat"></i></a>
        <a href="#" onclick="logout()"><i class="bi bi-power"></i></a>
    </nav>
</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
    /* ---------------------------------------------------------- */
    /* üîê S√©curit√© */
    /* ---------------------------------------------------------- */
    if (localStorage.getItem("isLogged") !== "true") {
        window.location.href = "index.html";
    }

    function logout() {
        alert("Vous √™tes d√©connect√©");
        localStorage.removeItem("isLogged");
        window.location.href = "index.html";
    }

    /* ---------------------------------------------------------- */
    /* üîß Connexion Supabase */
    /* ---------------------------------------------------------- */
    const client = supabase.createClient(
        "https://dxqffvubixwsxnoaudat.supabase.co",
        "sb_publishable_Jg2Z_fDjwpY9yF5KQLbAOA_j7lsbav9"
    );

    async function chargerStock() {
        const { data, error } = await client.from("stock").select("*");
        if (error) return [];
        return data;
    }

    async function chargerCategories() {
        const { data, error } = await client.from("categories").select("*");
        if (error) return [];
        return data;
    }

    async function chargerTransactions() {
        const { data, error } = await client
            .from("transactions")
            .select("*")
            .order("date", { ascending: false });

        if (error) return [];
        return data;
    }

    /* ---------------------------------------------------------- */
    /* üìä Chargement des donn√©es */
    /* ---------------------------------------------------------- */
    (async () => {

        const stock = await chargerStock();
        const categories = await chargerCategories();
        const transactions = await chargerTransactions();

        document.querySelector(".dashboard-card .card-value").textContent = stock.length;
        document.getElementById("nombre-categories").textContent = categories.length;
        document.getElementById("total-transactions").textContent = transactions.length;

        const stockNormal = stock.filter(p => p.qte > 5).length;
        const stockFaible = stock.filter(p => p.qte > 0 && p.qte <= 5).length;
        const stockRupture = stock.filter(p => p.qte === 0).length;

        document.getElementById("nb-stock-normal").textContent = stockNormal;
        document.getElementById("nb-stock-faible").textContent = stockFaible;
        document.getElementById("nb-stock-rupture").textContent = stockRupture;

        /* Produits critiques */
        const produitsCritiques = stock.filter(p => p.qte <= 2);
        const produitsContainer = document.getElementById("produits-critiques");
        produitsContainer.innerHTML = "";

        produitsCritiques.forEach(p => {
            produitsContainer.innerHTML += `
                <div class="product-item">
                    <div class="product-info">
                        <h4>${p.nom}</h4>
                        <p>Quantit√© : ${p.qte}</p>
                    </div>
                </div>`;
        });

        /* Derni√®res transactions */
        const derniereAjout = document.getElementById("derniere-ajout");
        derniereAjout.innerHTML = "";

        transactions.slice(0, 10).forEach(t => {
            const produit = stock.find(p => p.id === t.produit_id);

            derniereAjout.innerHTML += `
                <div class="product-item">
                    <div class="product-info">
                        <h4>${produit ? produit.nom : "Produit supprim√©"}</h4>
                        <p>Quantit√© ajout√©e : +${t.quantite}</p>
                        <p>Date : ${t.date}</p>
                    </div>
                </div>`;
        });

    })();

    /* ---------------------------------------------------------- */
    /* üì± Menu mobile */
    /* ---------------------------------------------------------- */
    document.addEventListener("DOMContentLoaded", () => {
        const header = document.querySelector("header.header");
        const nav = document.querySelector("header.header + nav");

        if (header && nav) {
            header.addEventListener("click", (e) => {
                if (e.clientX > window.innerWidth - 80) {
                    nav.classList.toggle("open");
                }
            });

            document.addEventListener("click", (e) => {
                if (!nav.contains(e.target) && !header.contains(e.target)) {
                    nav.classList.remove("open");
                }
            });
        }
    });
</script>
<script>
    function toggleMobileMenu() {
        document.getElementById("mobileMenu").classList.toggle("open");
    }
</script>


</body>
</html>
