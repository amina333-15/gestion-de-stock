<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Stock - AF.ELEC</title>

    <link rel="stylesheet" href="styleAppliMobil.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="icon" href="logo.png">

    <style>
/* ============================= */
/* MESSAGE "Aucun produit trouvé" */
/* ============================= */

.no-results {
    display: none;
    margin-top: 2rem;
    text-align: center;
    color: #777;
    line-height: 1.4;
}

.no-results i {
    font-size: 50px;
    color: var(--marron-fonce);
    margin-bottom: 5px;
    display: inline-block;
}

/* ============================= */
/* BARRE DE RECHERCHE — MOBILE   */
/* ============================= */

.search-bar-mobile {
    width: 100%;
    max-width: 500px;
    display: flex;
    gap: 0.6rem;
    margin-bottom: 1.5rem;
    justify-content: center;
}

.search-bar-mobile input {
    flex: 1;
    padding: 0.9rem;
    border: 1px solid #c8b8a6;
    border-radius: 8px;
    background-color: #fffff;
    font-size: 1rem;
    color: var(--texte-principal);
}

.search-btn {
    background-color: var(--marron-fonce);
    border: none;
    padding: 0.8rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    color: white;
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.search-btn:hover {
    background-color: var(--marron-hover);
    transform: scale(1.05);
}

/* ============================= */
/* LISTE MOBILE DU STOCK         */
/* ============================= */

.stock-list-mobile {
    width: 100%;
    max-width: 500px;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.stock-item {
    background-color: #ffffff;
    border: 1px solid #e0d6c8;
    border-radius: 12px;
    padding: 1.2rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);

    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;

    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.stock-item:hover {
    transform: translateX(4px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.12);
}

.stock-info h3 {
    margin: 0;
    font-size: 1.2rem;
    color: var(--texte-principal);
}

.stock-info p {
    margin: 0.2rem 0;
    font-size: 0.95rem;
    color: #555;
}

/* ============================= */
/* BOUTONS D’ACTION              */
/* ============================= */

.stock-actions {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
}

.edit-btn,
.delete-btn {
    background-color: var(--marron-fonce);
    border: none;
    padding: 0.6rem 0.8rem;
    border-radius: 8px;
    cursor: pointer;
    color: white;
    font-size: 1.2rem;
    transition: background-color 0.3s ease;
}

.edit-btn:hover,
.delete-btn:hover {
    background-color: var(--marron-hover);
}

/* ============================= */
/* BOUTON FLOTTANT AJOUT         */
/* ============================= */

.floating-add-btn {
    position: fixed;
    bottom: 25px;
    right: 25px;
    background-color: var(--marron-fonce);
    color: white;
    width: 60px;
    height: 60px;
    border-radius: 50%;

    display: flex;
    justify-content: center;
    align-items: center;

    font-size: 2rem;
    text-decoration: none;

    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    transition: background-color 0.3s ease, transform 0.2s ease;
    z-index: 3000;
}

.floating-add-btn:hover {
    background-color: var(--marron-hover);
    transform: scale(1.1);
}

/* ============================= */
/* POPUP                         */
/* ============================= */

.popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(3px);

    display: none;
    justify-content: center;
    align-items: center;

    z-index: 5000;
}

.popup-box {
    background: var(--beige-fond);
    padding: 2rem;
    border-radius: 12px;
    width: 90%;
    max-width: 380px;

    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    position: relative;
}

.popup-box h2 {
    margin-top: 0;
    color: var(--texte-principal);
}

.popup-box input,
.popup-box select {
    width: 100%;
    padding: 0.9rem;
    margin-bottom: 1rem;
    border: 1px solid #c8b8a6;
    border-radius: 6px;
    background-color: white;
    font-size: 1rem;
    color: var(--texte-principal);
    box-sizing: border-box;
}

.popup-box select {
    appearance: none;
    cursor: pointer;
    background-image: url("data:image/svg+xml;utf8,<svg fill='%236b4f2c' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 18px;
}

.popup-submit {
    width: 100%;
    padding: 1rem;
    background-color: var(--marron-fonce);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    font-size: 1.3rem;

    display: flex;
    justify-content: center;
    align-items: center;

    transition: background-color 0.3s ease, transform 0.2s ease;
}

.popup-submit:hover {
    background-color: var(--marron-hover);
    transform: scale(1.05);
}

.popup-submit i {
    font-size: 1.6rem;
}

.close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 1.8rem;
    cursor: pointer;
    color: var(--texte-principal);
}

/* CONTENEUR SCROLLABLE POUR TABLEAU */
.table-wrapper {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

/* TABLEAU STOCK */
.tab-stock {
    width: 100%;
    min-width: 600px; /* garantit que les colonnes restent lisibles */
    border-collapse: collapse;
    background-color: #ffffff;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.tab-stock th,
.tab-stock td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid #e0d6c8;
}

.tab-stock th {
    background-color: #9C5E3F;
    color: white;
    font-weight: 600;
}

/* BOUTONS ACTIONS */
.actions button {
    padding: 0.4rem 0.8rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    color: white;
    font-size: 0.9rem;
}

.edit-btn {
    background-color: #9C5E3F;
}

.delete-btn {
    background-color: #9C5E3F;
}

.edit-btn:hover,
.delete-btn:hover {
    background-color: #6b4f2c;
}


    </style>
</head>

<body>

<!-- HEADER MOBILE -->
<header class="topbar">
    <div class="topbar-content">
        <img src="logo.png" alt="Logo">
        <span>ELEC</span>
    </div>

    <div class="menu-btn" id="openMenu">
        <i class="bi bi-list"></i>
    </div>
</header>

<!-- MENU DÉPLIANT -->
<div class="side-menu" id="sideMenu">
    <div class="menu-header">
        <span>Menu</span>
        <i class="bi bi-x-lg" id="closeMenu"></i>
    </div>

    <nav class="menu-links">
        <a href="dashboardAppliMobil.html"><i class="bi bi-speedometer2"></i> Tableau de bord</a>
        <a href="stockAppliMobil.html"><i class="bi bi-box-seam"></i> Stock</a>
        <a href="categorieAppliMobil.html"><i class="bi bi-tags-fill"></i> Catégories</a>
        <a href="restockAppliMobil.html"><i class="bi bi-arrow-repeat"></i> Restock</a>
        <a href="#" onclick="logout()"><i class="bi bi-power"></i> Déconnexion</a>
    </nav>
</div>

<section class="container">

    <h1>Gestion du stock</h1>

    <!-- BARRE DE RECHERCHE -->
    <div class="search-bar-mobile">
        <input type="text" id="search" placeholder="Rechercher un produit...">
        <button class="search-btn"><i class="bi bi-search"></i></button>
    </div>

    <!-- LISTE MOBILE DU STOCK -->

    <div id="stock-list" class="stock-list-mobile"></div>

    <p id="no-results-stock" class="no-results">
        <i class="bi bi-search"></i><br>
        Aucun produit trouvé.
    </p>

</section>

<!-- BOUTON FLOTTANT AJOUT -->
<a onclick="ouvrirPopup('ajout')" class="floating-add-btn">
    <i class="bi bi-plus"></i>
</a>


<!-- POPUP -->
<div id="popup" class="popup-overlay">
    <div class="popup-box">
        <span class="close-btn" onclick="fermerPopup()">&times;</span>
        <h2 id="popup-title">Ajouter / Modifier un produit</h2>

        <form id="popup-form">
            <label>Nom :</label>
            <input type="text" id="popup-nom" required>

            <label>Catégorie :</label>
            <select id="popup-categorie" required></select>

            <label>Quantité :</label>
            <input type="number" id="popup-qte" required>

            <button type="submit" class="popup-submit">
                <i class="bi bi-check-lg"></i>
            </button>
        </form>
    </div>
</div>

<!-- FOOTER MOBILE -->
<footer>
    <div class="footer-nav">
        <a href="dashboardAppliMobil.html"><i class="bi bi-speedometer2"></i></a>
        <a href="stockAppliMobil.html"><i class="bi bi-box-seam"></i></a>
        <a href="categorieAppliMobil.html"><i class="bi bi-tags-fill"></i></a>
        <a href="restockAppliMobil.html"><i class="bi bi-arrow-repeat"></i></a>
        <a href="#" onclick="logout()"><i class="bi bi-power"></i></a>
    </div>
</footer>

<script>
    /* Sécurité */
    if (localStorage.getItem("isLogged") !== "true") {
        window.location.href = "indexAppliMobil.html";
    }

    function logout() {
        alert("Vous êtes déconnecté");
        localStorage.removeItem("isLogged");
        window.location.href = "indexAppliMobil.html";
    }

    /* Données */
    const defaultData = {
        categories: [
            { id: 1, nom: "Électricité" },
            { id: 2, nom: "Câblage" },
            { id: 3, nom: "Outillage" },
            { id: 4, nom: "Sécurité" }
        ],
        stock: [
            { id: 1, nom: "Disjoncteur 16A", categorie: "Électricité", qte: 12, date: "2026-01-15" },
            { id: 2, nom: "Prise murale", categorie: "Électricité", qte: 3, date: "2026-01-14" },
            { id: 3, nom: "Câble 2.5mm", categorie: "Câblage", qte: 25, date: "2026-01-10" }
        ]
    };

    let data = JSON.parse(localStorage.getItem("af_elec_data")) || defaultData;

    function sauvegarderData() {
        localStorage.setItem("af_elec_data", JSON.stringify(data));
    }

    /* Charger catégories */
    function chargerCategories() {
        const select = document.getElementById("popup-categorie");
        select.innerHTML = "";
        data.categories.forEach(cat => {
            const option = document.createElement("option");
            option.value = cat.nom;
            option.textContent = cat.nom;
            select.appendChild(option);
        });
    }

    /* Affichage mobile du stock */
    function afficherStock() {
        const list = document.getElementById("stock-list");
        list.innerHTML = "";

        data.stock.forEach(item => {
            list.innerHTML += `
                <div class="stock-item">
                    <div class="stock-info">
                        <h3>${item.nom}</h3>
                        <p>Catégorie : ${item.categorie}</p>
                        <p>Quantité : ${item.qte}</p>
                        <p>Date : ${item.date}</p>
                    </div>

                    <div class="stock-actions">
                        <button class="edit-btn" onclick="ouvrirPopup('modif', ${item.id})">
                            <i class="bi bi-pencil-square"></i>
                        </button>
                        <button class="delete-btn" onclick="supprimerProduit(${item.id})">
                            <i class="bi bi-trash-fill"></i>
                        </button>
                    </div>
                </div>
            `;
        });
    }

    function supprimerProduit(id) {
        data.stock = data.stock.filter(item => item.id !== id);
        sauvegarderData();
        afficherStock();
    }

    let mode = "ajout";
    let produitEnEdition = null;

    function ouvrirPopup(type, id = null) {
        mode = type;
        chargerCategories();

        document.getElementById("popup-title").textContent =
            type === "ajout" ? "Ajouter un produit" : "Modifier un produit";

        if (type === "modif") {
            produitEnEdition = data.stock.find(p => p.id === id);
            document.getElementById("popup-nom").value = produitEnEdition.nom;
            document.getElementById("popup-categorie").value = produitEnEdition.categorie;
            document.getElementById("popup-qte").value = produitEnEdition.qte;
        } else {
            produitEnEdition = null;
            document.getElementById("popup-form").reset();
        }

        document.getElementById("popup").style.display = "flex";
    }

    function fermerPopup() {
        document.getElementById("popup").style.display = "none";
    }

    document.getElementById("popup-form").addEventListener("submit", function(e) {
        e.preventDefault();

        const nom = document.getElementById("popup-nom").value;
        const categorie = document.getElementById("popup-categorie").value;
        const qte = parseInt(document.getElementById("popup-qte").value);
        const date = new Date().toISOString().split("T")[0];

        if (mode === "ajout") {
            data.stock.push({
                id: Date.now(),
                nom,
                categorie,
                qte,
                date
            });
        } else {
            produitEnEdition.nom = nom;
            produitEnEdition.categorie = categorie;
            produitEnEdition.qte = qte;
        }

        sauvegarderData();
        afficherStock();
        fermerPopup();
    });

    /* Recherche */
    function normalize(str) {
        return str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    document.getElementById("search").addEventListener("input", function () {
        const filter = normalize(this.value);
        const items = document.querySelectorAll(".stock-item");
        let visible = 0;

        items.forEach(item => {
            const text = normalize(item.textContent);
            const match = text.includes(filter);
            item.style.display = match ? "flex" : "none";
            if (match) visible++;
        });

        document.getElementById("no-results-stock").style.display =
            visible === 0 ? "block" : "none";
    });

    afficherStock();
</script>

<script>
    /* Menu dépliant */
    const openMenu = document.getElementById("openMenu");
    const closeMenu = document.getElementById("closeMenu");
    const sideMenu = document.getElementById("sideMenu");

    openMenu.addEventListener("click", () => sideMenu.classList.add("open"));
    closeMenu.addEventListener("click", () => sideMenu.classList.remove("open"));
</script>

</body>
</html>
